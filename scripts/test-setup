#!/usr/bin/env node
// scripts/test-setup.js
// Script para verificar que todo estÃ© configurado correctamente

const fs = require('fs');
const path = require('path');

console.log('ðŸ” Verificando configuraciÃ³n del proyecto...\n');

let errors = 0;
let warnings = 0;

// 1. Verificar que .env.local existe
console.log('1. Verificando archivo .env.local...');
const envPath = path.join(process.cwd(), '.env.local');
if (fs.existsSync(envPath)) {
  console.log('   âœ… .env.local encontrado');
  
  // Leer y verificar variables requeridas
  const envContent = fs.readFileSync(envPath, 'utf8');
  const requiredVars = [
    'GOOGLE_SHEETS_SPREADSHEET_ID',
    'GOOGLE_SERVICE_ACCOUNT_EMAIL',
    'GOOGLE_PRIVATE_KEY',
  ];
  
  const missingVars = requiredVars.filter(varName => !envContent.includes(varName));
  
  if (missingVars.length > 0) {
    console.log(`   âš ï¸  Faltan variables: ${missingVars.join(', ')}`);
    warnings++;
  } else {
    console.log('   âœ… Todas las variables requeridas estÃ¡n presentes');
  }
} else {
  console.log('   âŒ .env.local NO encontrado');
  console.log('   ðŸ’¡ Copia .env.example a .env.local y completa los valores');
  errors++;
}

// 2. Verificar node_modules
console.log('\n2. Verificando dependencias...');
const nodeModulesPath = path.join(process.cwd(), 'node_modules');
if (fs.existsSync(nodeModulesPath)) {
  console.log('   âœ… node_modules encontrado');
} else {
  console.log('   âŒ node_modules NO encontrado');
  console.log('   ðŸ’¡ Ejecuta: npm install');
  errors++;
}

// 3. Verificar estructura de carpetas
console.log('\n3. Verificando estructura de carpetas...');
const requiredDirs = [
  'src/pages',
  'src/pages/api',
  'src/components',
  'src/lib',
  'src/styles',
  'config',
];

let allDirsExist = true;
requiredDirs.forEach(dir => {
  const dirPath = path.join(process.cwd(), dir);
  if (fs.existsSync(dirPath)) {
    console.log(`   âœ… ${dir}`);
  } else {
    console.log(`   âŒ ${dir} NO existe`);
    allDirsExist = false;
    errors++;
  }
});

// 4. Verificar archivos crÃ­ticos
console.log('\n4. Verificando archivos crÃ­ticos...');
const requiredFiles = [
  'package.json',
  'next.config.js',
  'src/pages/index.js',
  'src/pages/_app.js',
  'src/lib/utils.js',
  'src/lib/sheets.js',
  'src/lib/scraper.js',
];

requiredFiles.forEach(file => {
  const filePath = path.join(process.cwd(), file);
  if (fs.existsSync(filePath)) {
    console.log(`   âœ… ${file}`);
  } else {
    console.log(`   âŒ ${file} NO existe`);
    errors++;
  }
});

// 5. Verificar version de Node.js
console.log('\n5. Verificando versiÃ³n de Node.js...');
const nodeVersion = process.version;
const majorVersion = parseInt(nodeVersion.split('.')[0].substring(1));

if (majorVersion >= 18) {
  console.log(`   âœ… Node.js ${nodeVersion} (requerido: >= 18)`);
} else {
  console.log(`   âš ï¸  Node.js ${nodeVersion} (recomendado: >= 18)`);
  warnings++;
}

// Resumen
console.log('\n' + '='.repeat(50));
console.log('ðŸ“Š RESUMEN DE VERIFICACIÃ“N\n');

if (errors === 0 && warnings === 0) {
  console.log('âœ… Â¡Todo estÃ¡ configurado correctamente!');
  console.log('\nðŸš€ Puedes ejecutar: npm run dev');
} else {
  if (errors > 0) {
    console.log(`âŒ ${errors} error(es) encontrado(s)`);
  }
  if (warnings > 0) {
    console.log(`âš ï¸  ${warnings} advertencia(s) encontrada(s)`);
  }
  console.log('\nðŸ’¡ Revisa los problemas indicados arriba');
}

console.log('='.repeat(50) + '\n');

// Exit code
process.exit(errors > 0 ? 1 : 0);
